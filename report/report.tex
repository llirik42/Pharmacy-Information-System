\documentclass[a4paper]{article}

\usepackage[a4paper, top=2cm, bottom=2cm, left=2cm, right=2cm]{geometry}
\usepackage[T1, T2A]{fontenc}
\usepackage[fontsize=12pt]{fontsize}

\usepackage[english, russian]{babel}
\usepackage[utf8]{inputenc}

\usepackage{hyperref}
\usepackage{amsthm}
\usepackage{tabularx}
\usepackage{pgfplots}
\usepackage{graphicx}
\usepackage{float}
\usepackage{tikz}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{indentfirst}

\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\hypersetup{pdfpagemode=FullScreen, colorlinks=true, linkcolor=black, urlcolor=cyan}

\newcommand{\dbtable}[1]{\textbf{#1}}
\newcommand{\dbtableref}[1]{\textit{#1}}
\begin{document}
	\input{title_page.tex}
	
	\tableofcontents
	
	\section{Задание}
		Разработать структуру базы данных для информационной системы аптеки и реализовать приложение в архитектуре клиент-сервер, выполняющее операции внесения данных в базу данных, редактирование данных и запросы.
		
		\subsection{Описание предметной области}
			Аптека продает медикаменты и изготавливает их по рецептам. Лекарства могут быть разных типов:
			\begin{enumerate}
				\item Готовые лекарства: таблетки, мази, настойки.
				
				\item Изготовляемые аптекой: микстуры, мази, растворы, настойки, порошки.
			\end{enumerate}
			Различие в типах лекарств отражается в различном наборе атрибутов, их характеризующих. Микстуры и порошки изготавливаются только для внутреннего применения, растворы для наружного, внутреннего применения и для смешивания с другими лекарствами и мази только для наружного применения. Лекарство различны также по способу приготовления и по времени приготовления. Порошки и мази изготавливаются смешиванием различных компонент. При изготовлении растворов и микстур ингредиенты не только смешивают, но и отстаивают с последующей фильтрацией лекарства, что увеличивает время изготовления.
			
			В аптеке существует справочник технологий приготовления различных лекарств. В нем указываются: идентификационный номер технологии, название лекарства и сам способ приготовления. На складе на все медикаменты устанавливается критическая норма, т.е. когда какого-либо вещества на складе меньше критической нормы, то составляются заявки на данные вещества и их в срочном порядке привозят с оптовых складов медикаментов.
			
			Для изготовления аптекой лекарства, больной должен принести рецепт от лечащего врача. В рецепте должно быть указано: ФИО, подпись и печать врача, ФИО, возраст и диагноз пациента, также количество лекарства и способ применения. Больной отдает рецепт регистратору, он принимает заказ и смотрит, есть ли компоненты заказываемого лекарства. Если не все компоненты имеются в наличии, то делает заявки на оптовые склады лекарств и фиксирует ФИО, телефон и адрес необслуженного покупателя, чтобы сообщить ему, когда доставят нужные компоненты. Такой больной пополняет справочник заказов - это те заказы, которые находятся в процессе приготовления, с пометкой, что не все компоненты есть для заказа. Если все компоненты имеются, то они резервируются для лекарства больного. Покупатель выплачивает цену лекарства, ему возвращается рецепт с пометкой о времени изготовления. Больной также пополняет справочник заказов в производстве. В назначенное время больной приходит и по тому же рецепту получает готовое лекарство. Такой больной пополняет список отданных заказов.
			
			Ведется статистика по объемам используемых медикаментов. Через определенный промежуток времени производится инвентаризация склада. Это делается для того, чтобы определить, есть ли лекарства с критической нормой, или вышел срок хранения или недостача.
		\subsection{Запросы к базы данных}
			\begin{enumerate}			
				\item Получить сведения о покупателях, которые не пришли забрать свой заказ в назначенное им время и общее их число.
				
				\item Получить перечень и общее число покупателей, которые ждут прибытия на склад нужных им медикаментов в целом и по указанной категории медикаментов.
				
				\item Получить перечень десяти наиболее часто используемых медикаментов в целом и указанной категории медикаментов.
				
				\item  Получить какой объем указанных веществ использован за указанный период.
				
				\item Получить перечень и общее число покупателей, заказывавших определенное лекарство или определенные типы лекарств за данный период.
				
				\item Получить перечень и типы лекарств, достигших своей критической нормы или закончившихся.
				
				\item Получить перечень лекарств с минимальным запасом на складе в целом и по указанной категории медикаментов.
				
				\item Получить полный перечень и общее число заказов находящихся в производстве.
				
				\item Получить полный перечень и общее число препаратов требующихся для заказов, находящихся в производстве.
				
				\item Получить все технологии приготовления лекарств указанных типов, конкретных лекарств, лекарств, находящихся в справочнике заказов в производстве.
				
				\item Получить сведения о ценах на указанное лекарство в готовом виде, об объеме и ценах на все компоненты, требующиеся для этого лекарства.
				
				\item Получить сведения о наиболее часто делающих заказы клиентах на медикаменты определенного типа, на конкретные медикаменты.
				
				\item Получить сведения о конкретном лекарстве (его тип, способ приготовления, названия всех компонент, цены, его количество на складе).
			\end{enumerate}
	\section{Таблицы и связи}
		\begin{figure}[H]
			\centering
			\def\svgwidth{\columnwidth}
			\input{scheme.pdf_tex}
			\caption{\small Графическая схема базы данных}
		\end{figure}
		
		\subsection{Описание таблиц}
			\begin{itemize}
				\item \dbtable{administration\_routes} --- способы применения лекарств (идентификатор способа, название);
				
				\item \dbtable{drug\_types} --- типы лекарств (идентификатор типа, название);
				
				\item \dbtable{drug\_types\_administration\_routes} --- соответствие между типами лекарств и способами их применения (идентификатор типа, идентификатор способа);
				
				\item \dbtable{customers} --- клиенты аптеки (идентификатор клиента, ФИО, номер телефона, адрес);
				
				\item \dbtable{doctors} --- врачи, которые выписывают рецепты для больных (идентификатор врача, ФИО);
				
				\item \dbtable{patients} --- пациенты, то есть те, на кого выписывают рецепты (идентификатор пациента, ФИО, дата рождения);
				
				\item \dbtable{suppliers} --- поставщики лекарств в аптеку (идентификатор поставщика, название, номер телефона);
				
				\item \dbtable{prescriptions} --- рецепты, выписанные больным врачами (идентификатор рецепта, диагноз, идентификатор пациента, идентификатор врача, дата);
				
				\item \dbtable{mixture\_types} --- типы микстур (идентификатор типа, название);
				
				\item \dbtable{drugs} --- лекарства (идентификатор лекарства, название, стоимость, срок годности, критическая норма, идентификатор типа --- из \dbtableref{drug\_types}, описание);
				
				\item \dbtable{mixtures} --- микстуры (идентификатор лекарства --- из \dbtableref{drugs}, растворитель, идентификатор типа микстуры --- из \dbtableref{mixture\_types});
				
				\item \dbtable{pills} --- таблетки (идентификатор лекарства --- из \dbtableref{drugs}, масса одной таблетки, масса пачки таблеток);
				
				\item \dbtable{powders} --- порошки (идентификатор лекарства --- из \dbtableref{drugs}, составной порошок или нет);
				
				\item \dbtable{salves} --- мази (идентификатор лекарства --- из \dbtableref{drugs}, действующее вещество);
				
				\item \dbtable{solutions} --- растворы (идентификатор лекарства --- из \dbtableref{drugs}, концентрация);
				
				\item \dbtable{tinctures} --- настойки (идентификатор лекарства --- из \dbtableref{drugs}, материал);
				
				\item \dbtable{prescriptions\_content} --- состав рецептов (идентификатор рецепта --- из \dbtableref{prescriptions}, идентификатор лекарства --- из \dbtableref{drugs}, количество лекарства, способ применения --- из \dbtableref{administration\_routes});
				
				\item \dbtable{storage\_items} --- позиции лекарств на складе (идентификатор позиции, идентификатор лекарства --- из \dbtableref{drugs}, текущее количество лекарства в позиции на складе, исходное количество лекарства в позиции на складе; дата получения);
				
				\item \dbtable{supplies} --- поставки лекарств от поставщиков (идентификатор поставки, идентификатор лекарства --- из \dbtableref{drugs}, количество лекарства, общая стоимость, идентификатор поставщика --- из \dbtableref{suppliers}, дата поставки);
				
				\item \dbtable{technologies} --- справочник технологий приготовления лекарств (идентификатор технологии, идентификатор лекарства --- из \dbtableref{drugs}, время приготовления, количество приготовляемого лекарства, инструкция);
				
				\item \dbtable{technology\_components} --- лекарства, требуемые для приготовления лекарств по технологиям (идентификатор технологии --- из \dbtableref{technologies}, идентификатор лекарства, требуемого для технологии --- из \dbtableref{drugs}, количество данного лекарства, требуемого для технологии);
				
				\item \dbtable{orders} --- заказы (идентификатор заказа, идентификатор рецепта --- из \dbtableref{prescriptions}, дата регистрации, назначенная дата получения заказа, реальная дата получения заказа, оплачен ли заказ, идентификатор клиента --- из \dbtableref{customers});
				
				\item \dbtable{orders\_ready\_drugs} --- какие лекарства для заказов уже готовы (идентификатор заказа --- из \dbtableref{orders}, идентификатор лекарства --- из \dbtableref{drugs}, количество лекарства);
				
				\item \dbtable{orders\_waiting\_drug\_supplies} --- поставки каких лекарств нужны для заказов (идентификатор заказа --- из \dbtableref{orders}, идентификатор лекарства --- из \dbtableref{drugs}, количество лекарства);
				
				\item \dbtable{reserved\_drugs} --- какие лекарства со склада зарезервированы для заказов (идентификатор заказа --- из \dbtableref{orders}, идентификатор позиции склада --- из \dbtableref{storage\_items}, количество лекарства);
				
				\item \dbtable{production} --- какие лекарства сейчас находятся в производстве для заказов (идентификатор заказа --- из \dbtableref{orders}, идентификатор технологии приготовления лекарства --- из \dbtableref{technologies}, количество процессов приготовления лекарства).
			\end{itemize}	
	\newpage
	\section{Создание таблиц}
		\lstinputlisting[
		language=SQL,
		backgroundcolor=\color{backcolour},
		basicstyle=\scriptsize,
		caption={SQL-скрипт для создания таблиц базы данных}
		]{../scheme.sql}
	\newpage
	\section{Ограничения по поддержанию целостности}
		Клиент будет взаимодействовать с базой данной через REST-API с сервером, поэтому все ограничения целостности должны быть учтены лишь на сервере. То есть если клиент пришлёт некорректный запрос к серверу, то сервер провалидирует запрос, установит, что он не корректен, но никаких запросов к базе данных не будет сделано.
\end{document}
